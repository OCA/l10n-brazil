-
  I prepare tunneling extra args in the context
-
  !python {model: sale.order}: |
    context.update({'fiscal_category_id': ref('l10n_br_account_product.fc_78df616ab31e95ee46c6a519a2ce9e12'), 'shop_id': ref('sale.sale_shop_1')})
-
  In order to test fiscal parameters of Sale Order inside the same state, I create sale order
-
  !record {model: sale.order, id: sale_order_test1}:
    partner_id: l10n_br_base.res_partner_akretion
    order_line:
      - product_id: product.product_product_7
        product_uom_qty: 8
-
  I verify that the onchange was correctly triggered
-
  !assert {model: sale.order, id: l10n_br_sale_stock.sale_order_test1, string: The onchange function of product was not correctly triggered}:
    - fiscal_category_id.id == ref('l10n_br_account_product.fc_78df616ab31e95ee46c6a519a2ce9e12')
    - fiscal_position.id == ref('l10n_br_account_product.fp_78df616ab31e95ee46c6a519a2ce9e12_internal_demo')
    - order_line[0].product_id.id == ref('product.product_product_7')
    - order_line[0].fiscal_category_id.id == ref('l10n_br_account_product.fc_78df616ab31e95ee46c6a519a2ce9e12')
    - order_line[0].fiscal_position.id == ref('l10n_br_account_product.fp_78df616ab31e95ee46c6a519a2ce9e12_internal_demo')
    - order_line[0].product_uom_qty == 8
    - order_line[0].product_uom.id == ref('product.product_uom_unit')
-
  I create another sale order
-
  !record {model: sale.order, id: sale_order_test2}:
    partner_id: l10n_br_base.res_partner_address_ak2
    order_line:
      - product_id: product.product_product_7
        product_uom_qty: 16
        product_uom: product.product_uom_dozen
-
  I verify that the onchange was correctly triggered
-
  !assert {model: sale.order, id: l10n_br_sale_stock.sale_order_test2, string: The onchange function of product was not correctly triggered}:
    - fiscal_category_id.id == ref('l10n_br_account_product.fc_78df616ab31e95ee46c6a519a2ce9e12')
    - fiscal_position.id == ref('l10n_br_account_product.fp_78df616ab31e95ee46c6a519a2ce9e12_external_icms12_demo')
    - order_line[0].product_id.id == ref('product.product_product_7')
    - order_line[0].fiscal_category_id.id == ref('l10n_br_account_product.fc_78df616ab31e95ee46c6a519a2ce9e12')
    - order_line[0].fiscal_position.id == ref('l10n_br_account_product.fp_78df616ab31e95ee46c6a519a2ce9e12_external_icms12_demo')
    - order_line[0].product_uom.id == ref('product.product_uom_dozen')
    - order_line[0].product_uom_qty == 16
