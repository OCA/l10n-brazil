<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

      <!-- Menus Principais -->
      <menuitem id="menu_project_scrum_dad" name="Scrum" parent="base.menu_main_pm" sequence="3"/>
      <menuitem id="menu_scrum_config" name="Configurations" parent="menu_project_scrum_dad" />

    	<!-- #### Project #### -->

         <record id="scrum_project_form" model="ir.ui.view">
            <field name="name">scrum.project.form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                <xpath expr='//field[@name="use_tasks"]' position='before'>
                    <field name="scrum_project"/>
                    <label for="scrum_project"/>
                </xpath>
                <xpath expr='//page[@string="Other Info"]' position='after'>
                <page string="Scrum" attrs="{'invisible': [('scrum_project', '=', False)]}">
                	<group string="Scrum" name="scrum">
	                	<field name="product_backlog_id" string="Product Backlog"/>
                	</group>
                </page>
               	</xpath>
            </field>
        </record>

         <record id="view_project_scrum_filter" model="ir.ui.view">
            <field name="name">project.scrum.select</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <search string="Search Project">
                    <field name="name" string="Project Name"/>
                    <filter icon="terp-mail-message-new" string="Unread Messages" name="message_unread" domain="[('message_unread','=',True)]"/>
                    <separator/>
                    <filter icon="terp-check" string="Open" name="Current" domain="[('state', '=','open')]" help="Open Projects"/>
                    <filter icon="terp-check" string="Scrum" name="Scrum" domain="[('scrum_project', '=','1')]" help="Scrum Projects"/>
                    <filter icon="gtk-media-pause" string="Pending" name="Pending" domain="[('state', '=','pending')]" help="Pending Projects"/>
                    <filter icon="gtk-media-pause" string="Template" name="Template" domain="[('state', '=','template')]" help="Templates of Projects"/>
                    <separator/>
                    <filter icon="terp-personal+" string="Member" domain="['|',('user_id', '=', uid),('members', '=', uid)]" help="Projects in which I am a member."/>
                    <separator/>
                    <filter string="Project(s) Manager" domain="[('user_id','=',uid)]" help="Projects in which I am a manager" icon="terp-personal"/>
                    <field name="user_id" string="Project Manager"/>
                    <field name="partner_id" string="Contact" filter_domain="[('partner_id', 'child_of', self)]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Manager" name="Manager" icon="terp-personal" domain="[]" context="{'group_by':'user_id'}"/>
                        <filter string="Contact" name="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Parent" name="Parent" help="Parent" icon="terp-folder-blue" domain = "[]" context="{'group_by':'parent_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="open_view_project_scrum" model="ir.actions.act_window">
            <field name="name">Scrum Projects</field>
            <field name="res_model">project.project</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form,gantt</field>
            <field name="view_id" ref="project.view_project_kanban"/>
            <field name="search_view_id" ref="view_project_scrum_filter"/>
            <field name="context">{'search_default_Scrum': 1,}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                  Click to start a new project.
                </p><p>
                  Projects are used to organize your activities; plan
                  tasks, track issues, invoice timesheets. You can define
                  internal projects (R&amp;D, Improve Sales Process),
                  private projects (My Todos) or customer ones.
                </p><p>
                  You will be able collaborate with internal users on
                  projects or invite customers to share your activities.
                </p>
            </field>
        </record>

       	<menuitem id="menu_project_scrum" name="Scrum Projects" action="open_view_project_scrum" parent="menu_project_scrum_dad" />
       	<!--#####################################################################################-->

       	<!-- #### Product Backlog #### -->
       	<record id="scrum_product_backlog_form" model="ir.ui.view">
            <field name="name">scrum.product.backlog.form</field>
            <field name="model">scrum.product.backlog</field>
            <field name="arch" type="xml">
            	<form string="Product Backlog" version="7.0">
            		<sheet string="Product Backlog">
            			    <div class="oe_title">
	                        <label for="name" class="oe_edit_only" string="Product Backlog Name"/>
	                        <h1>
	                            <field name="name" string="Name"/>
	                        </h1>
                    	</div>
                      <newline/>
                      <group col="4">
                        <field name="product_owner" colspan="2"/>
                        <field name="scrum_master" colspan="2"/>
                        <field name="project_id" colspan="2"/>
                        <field name="project_progress_rate" colspan="2" widget="progressbar"/>
                      </group> 
                      
                    	<notebook>
                    		<page string="Items">
	                        	<field name="items" string="Items" domain="['product_backlog_id', '=', active_id]" context="{'product_backlog_id': active_id}" />
	                        </page>
                    		<page string="Releases">
	                        	<field name="releases" string="Releases"/>
	                        </page>
	                    </notebook>
				      	</sheet>
               </form>
            </field>
        </record>

        <record id="scrum_product_backlog_tree" model="ir.ui.view">
            <field name="name">scrum.product.backlog.tree</field>
            <field name="model">scrum.product.backlog</field>
            <field name="arch" type="xml">
                <tree string="Product Backlog">
                  <field name="name"/>
                  <field name="project_id"/>
                </tree>
            </field>
        </record>

        <record id="open_view_scrum_product_backlog" model="ir.actions.act_window">
            <field name="name">Product Backlog</field>
            <field name="res_model">scrum.product.backlog</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_scrum_product_backlog" name="Product Backlog" action="open_view_scrum_product_backlog" parent="menu_project_scrum_dad" />
        <!--#####################################################################################-->

        <!-- #### Release Backlog #### -->
       	<record id="scrum_release_backlog_form" model="ir.ui.view">
            <field name="name">scrum.release.backlog.form</field>
            <field name="model">scrum.release.backlog</field>
            <field name="arch" type="xml">
            	<form string="Release Backlog" version="7.0">
            		<sheet string="Release Backlog">
            			<div class="oe_title">
	                        <label for="name" class="oe_edit_only" string="Release Backlog Name"/>
	                        <h1>
	                            <field name="name" string="Name"/>
	                        </h1>
	                        <group>
	                        <field name="product_backlog_id"/>
	                    	</group>
                    	</div>
                    	<notebook>
                    		<page string="Sprints">                    			
	                        	<field name="sprints"/>
                    		</page>
                    		<page string="Items">                    			
	                        	<field name="items" domain="[('product_backlog_id','=',product_backlog_id)]" />
                    		</page>
                    	</notebook>
					</sheet>
               </form>
            </field>
        </record>

        <record id="scrum_release_backlog_tree" model="ir.ui.view">
            <field name="name">scrum.release.backlog.tree</field>
            <field name="model">scrum.release.backlog</field>
            <field name="arch" type="xml">
                <tree string="Release Backlog">
                  <field name="name"/>
                  <field name="product_backlog_id"/>
                </tree>
            </field>
        </record>

        <record id="open_view_scrum_release_backlog" model="ir.actions.act_window">
            <field name="name">Release Backlog</field>
            <field name="res_model">scrum.release.backlog</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_scrum_release_backlog" name="Release Backlog" action="open_view_scrum_release_backlog" parent="menu_project_scrum_dad" />
        <!--#####################################################################################-->

        <!-- #### Sprint #### -->
        <record id="scrum_sprint_form" model="ir.ui.view">
            <field name="name">scrum.sprint.form</field>
            <field name="model">scrum.sprint</field>
            <field name="arch" type="xml">
            	<form string="Sprint" version="7.0">
            		<sheet string="Sprint">
            			    <div class="oe_title">
	                      <label for="name" class="oe_edit_only" string="Sprint Name"/>
	                        <h1>
	                            <field name="name" string="Name"/>
	                        </h1>
                    	</div>
                      <group col="4">
                          <field name="product_backlog_id" colspan="2"/>
                          <field name="release_backlog_id" domain="[('product_backlog_id','=',product_backlog_id)]" colspan="2" on_change="onchange_pb_id(product_backlog_id,release_backlog_id)" />
                      </group>
                      <group col="4">
                          <field name="product_owner" colspan="2"/>
                          <field name="scrum_master" colspan="2"/>
                      </group>
                      <group col="4">
                          <field name="start_date" colspan="2" on_change="calculate_days(start_date,end_date)"/>
                          <field name="end_date" colspan="2" on_change="calculate_days(start_date,end_date)"/>
                      </group>
                      <group col="4">
                        <field name="days" colspan="2"/>
                        <!--<field name="progress_rate" colspan="2"/>-->
                      </group>
                      <notebook>
                          <page string="Items">
                            <field name="items" domain="[('product_backlog_id','=',product_backlog_id)]"/>
                          </page>
                          <page string="Meetings">
                            <field name="meetings" domain="[('sprint_id','=',id)]"/>
                          </page>
                      </notebook>
					      </sheet>
               </form>
            </field>
        </record>

        <record id="scrum_sprint_tree" model="ir.ui.view">
            <field name="name">scrum.sprint.tree</field>
            <field name="model">scrum.sprint</field>
            <field name="arch" type="xml">
                <tree string="Sprint">
                  <field name="name"/>
                  <field name="product_backlog_id"/>
                  <field name="release_backlog_id"/>
                  <field name="start_date"/>
                  <field name="end_date"/>
                  <field name="days"/>
                  <field name="scrum_master"/>
                </tree>
            </field>
        </record>

        <record id="open_view_scrum_sprint" model="ir.actions.act_window">
            <field name="name">Sprints</field>
            <field name="res_model">scrum.sprint</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
        </record>



        <menuitem id="menu_scrum_sprint" name="Sprints" action="open_view_scrum_sprint" parent="menu_project_scrum_dad" />
        <!--#####################################################################################-->


        <!-- #### Product Backlog Item #### -->
        <record id="scrum_product_backlog_item_form" model="ir.ui.view">
            <field name="name">scrum.product.backlog.item.form</field>
            <field name="model">scrum.product.backlog.item</field>
            <field name="arch" type="xml">
            	<form string="Product Backlog Item" version="7.0">
            		<sheet string="Item">
            			<div class="oe_title">
	                        <label for="name" class="oe_edit_only" string="Item Name"/>
	                        <h1>
	                            <field name="name" string="Name"/>
	                        </h1>
                          </div>
	                        <group col="4">
                          <field name="product_backlog_id" colspan="2"/>
                          <field name="release_backlog_id" colspan="2" domain="[('product_backlog_id', '=', product_backlog_id)]" context="{'product_backlog_id': product_backlog_id}"/>
                          <field name="sprint_id" colspan="2" domain="[('release_backlog_id','=',release_backlog_id)]" context="{'product_backlog_id': product_backlog_id,'release_backlog_id': release_backlog_id}"/>
                          <field name="ref" colspan="2"/>
                          <field name="requestor" colspan="2"/>
	                        <field name="priority" colspan="2"/>
	                        <field name="sequence" colspan="2"/>
	                        <field name="description" colspan="4"/>
	                    	</group>
                    	
                    <notebook>
                          <page string="Task">
                            <group col="4">
                               <field name="task"/>
                               <field name="task_user_id"/>
                               <field name="task_progress" widget="progressbar"/>
                            </group>
                          </page>
                      </notebook>
					      </sheet>
               </form>
            </field>
        </record>

        <record id="scrum_product_backlog_item_tree" model="ir.ui.view">
            <field name="name">scrum.product.backlog.item.tree</field>
            <field name="model">scrum.product.backlog.item</field>
            <field name="arch" type="xml">
              <tree string="Items">
                <field name="name"/>
                
                <field name="release_backlog_id"/>
                <field name="sprint_id"/>
                <field name="ref"/>
                <field name="task_user_id"/>
                <field name="task_progress" widget="progressbar"/>
              </tree>
            </field>
        </record>

        <record id="open_view_scrum_product_backlog_item" model="ir.actions.act_window">
            <field name="name">Backlog Item</field>
            <field name="res_model">scrum.product.backlog.item</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_scrum_product_backlog_item" name="Item Backlog" action="open_view_scrum_product_backlog_item" parent="menu_project_scrum_dad" />
        <!--#####################################################################################-->

        <!-- #### Scrum Meeting #### -->
        <record id="scrum_meeting_form" model="ir.ui.view">
            <field name="name">scrum.meeting.form</field>
            <field name="model">scrum.meeting</field>
            <field name="arch" type="xml">
              <form string="Meeting" version="7.0">
                <sheet string="Meeting">
                  <group col="4">
                    <field name="date" colspan="2"/>
                    <field name="sprint_id" colspan="2"/>
                  </group>
                  <group col="4"> 
                    <field name="last_work" colspan="4"/>
                    <field name="next_work" colspan="4"/>
                    <field name="blocking" colspan="4"/>
                  </group>

                </sheet>
               </form>
            </field>
        </record>

        <record id="scrum_meeting_tree" model="ir.ui.view">
            <field name="name">scrum.meeting.tree</field>
            <field name="model">scrum.meeting</field>
            <field name="arch" type="xml">
              <tree string="Meeting">
                <field name="date"/>
                <field name="sprint_id"/>
              </tree>
            </field>
        </record>

        <record id="open_view_scrum_meeting" model="ir.actions.act_window">
            <field name="name">Meeting</field>
            <field name="res_model">scrum.meeting</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_scrum_meeting" name="Meetings" action="open_view_scrum_meeting" parent="menu_project_scrum_dad" />
        <!--#####################################################################################-->

        <!-- #### Task #### -->
         <record id="scrum_project_task_form" model="ir.ui.view">
            <field name="name">scrum.project.task.form</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr='//page[@string="Extra Info"]' position='after'>
                <page string="Scrum" attrs="{'invisible': [('release_backlog_id', '=', False)]}">
                  <group string="Scrum" name="scrum">
                    <field name="release_backlog_id"/>
                    <field name="sprint_id"/>
                    <!--<field name="planned_hours" widget="float_time"/>-->
                  </group>
                </page>
                </xpath>
            </field>
        </record>

        <!-- #### Item Reference #### -->
        <record id="scrum_product_backlog_item_ref_form" model="ir.ui.view">
            <field name="name">scrum.product.backlog.item.ref.form</field>
            <field name="model">scrum.product.backlog.item.ref</field>
            <field name="arch" type="xml">
              <form string="Product Backlog Item Reference" version="7.0">
                <sheet string="Reference">
                  <div class="oe_title">
                      <label for="name" class="oe_edit_only" string="Item Name"/>
                      <h1>
                          <field name="name" string="Name"/>
                      </h1>
                  </div>
                </sheet>
               </form>
            </field>
        </record>

        <record id="scrum_product_backlog_item_ref_tree" model="ir.ui.view">
            <field name="name">scrum.product.backlog.item.ref.tree</field>
            <field name="model">scrum.product.backlog.item.ref</field>
            <field name="arch" type="xml">
              <tree string="References">
                <field name="name"/>
              </tree>
            </field>
        </record>

        <record id="open_view_scrum_product_backlog_item_ref" model="ir.actions.act_window">
            <field name="name">Reference</field>
            <field name="res_model">scrum.product.backlog.item.ref</field>
            <field name="view_type">form</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,form</field>
        </record>

        

        <menuitem id="menu_scrum_product_backlog_item_ref" name="Item Backlog Reference" action="open_view_scrum_product_backlog_item_ref" parent="menu_scrum_config" />

        
        <!--#####################################################################################-->

    </data>
</openerp>