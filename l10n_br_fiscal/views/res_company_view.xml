<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="fiscal_res_company_form" model="ir.ui.view">
        <field name="name">l10n_br_fiscal.res.company.form</field>
        <field name="model">res.company</field>
        <field name="inherit_id" ref="base.view_company_form"/>
        <field name="arch" type="xml">
            <notebook>
                <page name="fiscal" string="Fiscal" groups="l10n_br_fiscal.group_manager">
                    <notebook>
                        <page name="tax_framework" string="Tax Framework">
                            <field name="id" invisible="1"/>
                            <group string="Tax Framework">
                                <field name="tax_framework"/>
                                <field name="accountant_id"/>
                            </group>
                            <group name="simples" string="Simples Nacional" attrs="{'invisible': [('tax_framework', '=', '3')]}">
                                <group>
                                    <field name="annual_revenue"/>
                                </group>
                                <group>
                                    <field name="simplifed_tax_id"/>
                                    <field name="simplifed_tax_range_id"/>
                                    <field name="simplifed_tax_percent"/>
                                </group>
                            </group>
                            <group name="normal" string="Regime Normal" attrs="{'invisible': [('tax_framework', '!=', '3')]}">
                                <group>
                                    <field name="profit_calculation" attrs="{'required': [('tax_framework', '=', '3')]}"/>
                                </group>
                                <group>
                                    <field name="is_industry"/>
                                    <field name="industry_type" attrs="{'invisible': [('is_industry', '=', False)], 'required': [('is_industry', '=', True)]}"/>
                                </group>
                            </group>
                            <group string="CNAE">
                                <field name="cnae_main_id"/>
                            </group>
                            <group colspan="4" string="Secondary CNAE">
                                <field colspan="4" nolabel="1" name="cnae_secondary_ids"/>
                            </group>
                        </page>
                        <page name="taxes" string="Taxes">
                            <group name="normal_taxes" string="Default Taxes">
                                  <group name="piscofins_taxes" string="PIS/COFINS">
                                      <field name="piscofins_id" required="1" domain="{'3': [('piscofins_type', '=', 'company'), ('id', '!=', %(l10n_br_fiscal.tax_pis_cofins_simples_nacional)d)]}.get(tax_framework, [('piscofins_type', '=', 'company'), ('id', '=', %(l10n_br_fiscal.tax_pis_cofins_simples_nacional)d)])"/>
                                  </group>
                                  <group name="ipi_taxes" string="IPI">
                                      <field name="ripi" attrs="{'invisible': [('tax_framework', '!=', '3')]}"/>
                                      <field name="tax_ipi_id" attrs="{'invisible': [('tax_framework', '=', '3'), ('ripi', '=', True)], 'required': [('tax_framework', '!=', '3')]}"  domain="{'3': [('id', '!=', %(l10n_br_fiscal.tax_ipi_simples_nacional)d), ('tax_group_id', '=', %(l10n_br_fiscal.tax_group_ipi)d)]}.get(tax_framework, [('id', '=', %(l10n_br_fiscal.tax_ipi_simples_nacional)d)])"/>
                                      <div class="text-muted" colspan="2" attrs="{'invisible': [('ripi', '=', False)]}">
                                          IPI tax will be calculed by Product NCM and Fiscal Operation.
                                      </div>
                                  </group>
                                  <group name="icms_taxes" string="ICMS">
                                      <field name="tax_icms_id" attrs="{'invisible': [('tax_framework', '=', '3')], 'required': [('tax_framework', 'in', ('1', '2'))]}" domain="{'3': [('tax_group_id', '=', %(l10n_br_fiscal.tax_group_icms)d)]}.get(tax_framework, [('tax_group_id', '=', %(l10n_br_fiscal.tax_group_icmssn)d)])"/>
                                  </group>
                                  <group name="issqn_taxes" string="ISSQN">
                                      <field name="tax_issqn_id"/>
                                  </group>
                            </group>
                            <group name="advanced_taxes" string="Advanced Taxes">
                                <field name="tax_definition_ids" nolabel="1" context="{'default_company_id': id}">
                                    <tree>
                                        <field name="tax_group_id"/>
                                        <field name="is_taxed"/>
                                    </tree>
                                    <form string="Tax Definition">
                                        <field name="company_id" invisible="1"/>
                                        <field name="tax_domain" invisible="1"/>
                                        <field name="type_in_out" invisible="1"/>
                                        <group>
                                            <field name="tax_group_id"/>
                                            <field name="is_taxed"/>
                                            <field name="is_debit_credit" attrs="{'invisible': [('is_taxed', '=', False)]}"/>
                                            <field name="tax_retention"/>
                                            <field name="custom_tax"/>
                                            <field name="tax_id" attrs="{'invisible': [('custom_tax', '=', False)], 'required': [('custom_tax', '=', True)]}"/>
                                            <field name="cst_id" attrs="{'invisible': [('custom_tax', '=', False)], 'required': [('custom_tax', '=', True)]}"/>
                                        </group>
                                    </form>
                                </field>
                            </group>
                        </page>
                        <page name="certificate" string="Certificates">
                            <group name="certificate" string="Certificate">
                                <group>
                                    <field name="certificate_ecnpj_id"/>
                                </group>
                                <group>
                                    <field name="certificate_nfe_id"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </page>
            </notebook>
        </field>
    </record>

</odoo>
