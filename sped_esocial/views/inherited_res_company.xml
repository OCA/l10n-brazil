<?xml version="1.0" encoding="UTF-8" ?>
<openerp>
    <data>

        <record model="ir.ui.view" id="sped_res_company">
            <field name="name">Adiciona e-Social na Empresa</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="l10n_br_account_product.view_l10n_br_account_company_form" />
            <field name="arch" type="xml">
                <xpath expr="//page[@string='Retenções']" position="after">
                    <page name="esocial_matriz" string="e-Social Matriz" attrs="{'invisible': [('eh_empresa_base', '=', False)]}">
                        <group colspan="4" col="4">
                            <group colspan="4" col="2">
                                <field name="esocial_tpAmb" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="natureza_juridica_id" options="{'no_create': True, 'no_open': True}" required="True" />
                                <field name="ind_coop" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="ind_constr" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="ind_opt_reg_eletron" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="ind_ent_ed"/>
                                <field name="ind_ett" />
                                <field name="nr_reg_ett" />
                                <field name="esocial_nm_ctt" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="esocial_cpf_ctt" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="esocial_fone_fixo" attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                <field name="esocial_fone_cel" />
                                <field name="esocial_email" />
                            </group>
                            <group colspan="2" col="2">
                                <field name="esocial_periodo_inicial_id"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'required': [('sped_empregador_id', '!=', False)]}"
                                />
                                <field name="esocial_periodo_atualizacao_id"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'required': [('sped_empregador_id', '!=', False)]}"
                                />
                                <field name="esocial_periodo_final_id"
                                       options="{'no_create': True, 'no_open': True}"
                                />
                            </group>
                            <group colspan="2" col="2">
                                <field name="situacao_esocial" attrs="{'invisible': [('situacao_esocial', '=', False)]}" />
                                <field name="sped_empregador_id" invisible="1" />
                                <field name="cnpj_cpf_limpo" invisible="1" />
                                <button name="atualizar_esocial" colspan="4" type="object"
                                        string="Ativar Empregador no e-Social" class="oe_highlight"
                                        attrs="{'invisible': ['|', ('situacao_esocial', 'in', ['1', '3', '9']), ('esocial_periodo_inicial_id', '=', False)]}" />
                            </group>
                        </group>
                    </page>
                    <page name="esocial_estabelecimento" string="e-Social Estab./Lotação">
                        <group colspan="4" col="4">
                            <group colspan="4" col="4" string="Estabelecimento">
                                <field name="tp_caepf" colspan="4"/>
                                <field name="reg_pt" required="1" colspan="4"/>
                                <field name="cont_apr" required="1" colspan="4"/>
                                <field name="cont_ent_ed" colspan="4"/>
                                <field name="cont_pcd" colspan="4"/>
                            </group>
                            <group colspan="4" col="4" string="Lotação Tributária">
                                <field name="cod_lotacao" attrs="{'required': True}" />
                                <field name="tp_lotacao_id" attrs="{'required': True}"
                                       options="{'no_create': True, 'no_open': True}"
                                />
                                <field name="tp_insc_id"
                                       options="{'no_create': True, 'no_open': True}"
                                />
                                <field name="nr_insc" />
                                <field name="fpas_id" attrs="{'required': True}"
                                       options="{'no_create': True, 'no_open': True}"
                                />
                                <field name="cod_tercs" attrs="{'required': True}" />
                                <!--<field name="cod_tercs_id" attrs="{'required': True}"-->
                                       <!--options="{'no_create': True, 'no_open': True}"-->
                                <!--/>-->
                                <!--domain="[('codigo_tributaria_fpas_ids', '=', fpas_id.id)]"-->
                            </group>
                            <group colspan="4" col="1">
                                <field name="info_ent_educ_ids" />
                            </group>
                            <group colspan="2" col="2" string="Estabelecimento">
                                <field name="estabelecimento_periodo_inicial_id"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'required': [('sped_estabelecimento_id', '!=', False)]}"
                                />
                                <field name="estabelecimento_periodo_atualizacao_id"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'required': [('sped_estabelecimento_id', '!=', False)]}"
                                />
                                <field name="estabelecimento_periodo_final_id"
                                       options="{'no_create': True, 'no_open': True}"
                                />
                            </group>
                            <group colspan="2" col="2" string="Estabelecimento">
                                <field name="situacao_estabelecimento_esocial" attrs="{'invisible': [('situacao_estabelecimento_esocial', '=', False)]}" />
                                <field name="sped_estabelecimento_id" invisible="1" />
                                <button name="atualizar_estabelecimento" colspan="4" type="object"
                                        string="Ativar Estabelecimento no e-Social" class="oe_highlight"
                                        attrs="{'invisible': ['|', ('situacao_estabelecimento_esocial', 'in', ['1', '3', '9']), ('estabelecimento_periodo_inicial_id', '=', False)]}" />
                            </group>
                            <group colspan="2" col="2" string="Lotação Tributária">
                                <field name="lotacao_periodo_inicial_id"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'required': [('sped_lotacao_id', '!=', False)]}"
                                />
                                <field name="lotacao_periodo_atualizacao_id"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'required': [('sped_lotacao_id', '!=', False)]}"
                                />
                                <field name="lotacao_periodo_final_id"
                                       options="{'no_create': True, 'no_open': True}"
                                />
                            </group>
                            <group colspan="2" col="2" string="Lotação Tributária">
                                <field name="situacao_lotacao_esocial" attrs="{'invisible': [('situacao_lotacao_esocial', '=', False)]}" />
                                <field name="sped_lotacao_id" invisible="1" />
                                <button name="atualizar_lotacao" colspan="4" type="object"
                                        string="Ativar Lotação no e-Social" class="oe_highlight"
                                        attrs="{'invisible': ['|', ('situacao_lotacao_esocial', 'in', ['1', '3', '9']), ('lotacao_periodo_inicial_id', '=', False)]}" />
                            </group>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- Herança na aciton do core para o menu padrão da empresa continuar carregando corretamente.-->
        <record id="base.action_res_company_form" model="ir.actions.act_window">
            <field name="name">Companies</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">res.company</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help">Create and manage the companies that will be managed by Odoo from here. Shops or subsidiaries can be created and maintained from here.</field>
        </record>

        <record model="ir.actions.act_window.view" id="res_company_tree_action">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="base.view_company_tree"/>
            <field name="act_window_id" ref="base.action_res_company_form"/>
        </record>

        <record model="ir.actions.act_window.view" id="res_company_form_action">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="l10n_br_account_product.view_l10n_br_account_company_form"/>
            <field name="act_window_id" ref="base.action_res_company_form"/>
        </record>



        <!---->
        <!-- Menu do empregador (res.company) na visao do SPED -->
        <!---->
        <record model="ir.ui.view" id="sped_esocial_res_company_form">
            <field name="name">Empregador e-Social</field>
            <field name="model">res.company</field>
            <field name="arch" type="xml">
                <form string="Company">
                    <sheet>
                        <div>
                            <field name="logo" widget="image"
                                   class="oe_avatar oe_left"/>
                        </div>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="name" class="oe_inline"/>
                            </h1>
                        </div>
                        <div attrs="{'invisible' : [('logo','!=',False)]}"
                             class="oe_view_nocontent oe_clear">
                            <p class="oe_view_nocontent_create oe_edit_only">
                                Click to set your company logo.
                            </p>
                        </div>
                        <group col="4">
                            <field name="parent_id" groups="base.group_multi_company"/>
                            <field name="eh_empresa_base" invisible="1"/>
                        </group>
                        <notebook colspan="4">
                            <page name="esocial_matriz" string="e-Social Matriz"
                                  attrs="{'invisible': [('eh_empresa_base', '=', False)]}">
                                <group colspan="4" col="4">
                                    <group colspan="4" col="2">
                                        <field name="esocial_tpAmb"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="natureza_juridica_id" required="True"
                                               options="{'no_create': True, 'no_open': True}"/>
                                        <field name="ind_coop"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="ind_constr"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="ind_opt_reg_eletron"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="ind_ent_ed"/>
                                        <field name="ind_ett"/>
                                        <field name="nr_reg_ett"/>
                                        <field name="esocial_nm_ctt"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="esocial_cpf_ctt"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="esocial_fone_fixo"
                                               attrs="{'required': [('eh_empresa_base', '=', True)]}"/>
                                        <field name="esocial_fone_cel"/>
                                        <field name="esocial_email"/>
                                    </group>
                                    <group colspan="2" col="2">
                                        <field name="esocial_periodo_inicial_id"
                                               options="{'no_create': True, 'no_open': True}"
                                               attrs="{'required': [('sped_empregador_id', '!=', False)]}"
                                        />
                                        <field name="esocial_periodo_atualizacao_id"
                                               options="{'no_create': True, 'no_open': True}"
                                               attrs="{'required': [('sped_empregador_id', '!=', False)]}"
                                        />
                                        <field name="esocial_periodo_final_id"
                                               options="{'no_create': True, 'no_open': True}"
                                        />
                                    </group>
                                    <group colspan="2" col="2">
                                        <field name="situacao_esocial"
                                               attrs="{'invisible': [('situacao_esocial', '=', False)]}"/>
                                        <field name="sped_empregador_id"
                                               invisible="1"/>
                                        <button name="atualizar_esocial"
                                                colspan="4" type="object"
                                                string="Ativar/Atualizar e-Social"
                                                class="oe_highlight"
                                                attrs="{'invisible': ['|', ('situacao_esocial', 'in', ['1', '3', '9']), ('esocial_periodo_inicial_id', '=', False)]}"/>
                                    </group>
                                </group>
                            </page>
                            <page name="esocial_estabelecimento"
                                  string="e-Social Estab./Lotação">
                                <group colspan="4" col="4">
                                    <group colspan="4" col="4"
                                           string="Estabelecimento">
                                        <field name="tp_caepf" colspan="4"/>
                                        <field name="reg_pt" required="1"
                                               colspan="4"/>
                                        <field name="cont_apr" required="1"
                                               colspan="4"/>
                                        <field name="cont_ent_ed" colspan="4"/>
                                        <field name="cont_pcd" colspan="4"/>
                                    </group>
                                    <group colspan="4" col="4"
                                           string="Lotação Tributária">
                                        <field name="cod_lotacao"
                                               attrs="{'required': True}"/>
                                        <field name="tp_lotacao_id"
                                               attrs="{'required': True}"
                                               options="{'no_create': True, 'no_open': True}"
                                        />
                                        <field name="tp_insc_id"
                                               options="{'no_create': True, 'no_open': True}"
                                        />
                                        <field name="nr_insc"/>
                                        <field name="fpas_id"
                                               attrs="{'required': True}"
                                               options="{'no_create': True, 'no_open': True}"
                                        />
                                        <field name="cod_tercs"
                                               attrs="{'required': True}"/>
                                        <!--<field name="cod_tercs_id" attrs="{'required': True}"-->
                                        <!--options="{'no_create': True, 'no_open': True}"-->
                                        <!--/>-->
                                        <!--domain="[('codigo_tributaria_fpas_ids', '=', fpas_id.id)]"-->
                                    </group>
                                    <group colspan="4" col="1">
                                        <field name="info_ent_educ_ids"/>
                                    </group>
                                    <group colspan="2" col="2"
                                           string="Estabelecimento">
                                        <field name="estabelecimento_periodo_inicial_id"
                                               options="{'no_create': True, 'no_open': True}"
                                               attrs="{'required': [('sped_estabelecimento_id', '!=', False)]}"
                                        />
                                        <field name="estabelecimento_periodo_atualizacao_id"
                                               options="{'no_create': True, 'no_open': True}"
                                               attrs="{'required': [('sped_estabelecimento_id', '!=', False)]}"
                                        />
                                        <field name="estabelecimento_periodo_final_id"
                                               options="{'no_create': True, 'no_open': True}"
                                        />
                                    </group>
                                    <group colspan="2" col="2"
                                           string="Estabelecimento">
                                        <field name="situacao_estabelecimento_esocial"
                                               attrs="{'invisible': [('situacao_estabelecimento_esocial', '=', False)]}"/>
                                        <field name="sped_estabelecimento_id"
                                               invisible="1"/>
                                        <button name="atualizar_estabelecimento"
                                                colspan="4" type="object"
                                                string="Ativar/Atualizar e-Social"
                                                class="oe_highlight"
                                                attrs="{'invisible': ['|', ('situacao_estabelecimento_esocial', 'in', ['1', '3', '9']), ('estabelecimento_periodo_inicial_id', '=', False)]}"/>
                                    </group>
                                    <group colspan="2" col="2"
                                           string="Lotação Tributária">
                                        <field name="lotacao_periodo_inicial_id"
                                               options="{'no_create': True, 'no_open': True}"
                                               attrs="{'required': [('sped_lotacao_id', '!=', False)]}"
                                        />
                                        <field name="lotacao_periodo_atualizacao_id"
                                               options="{'no_create': True, 'no_open': True}"
                                               attrs="{'required': [('sped_lotacao_id', '!=', False)]}"
                                        />
                                        <field name="lotacao_periodo_final_id"
                                               options="{'no_create': True, 'no_open': True}"
                                        />
                                    </group>
                                    <group colspan="2" col="2"
                                           string="Lotação Tributária">
                                        <field name="situacao_lotacao_esocial"
                                               attrs="{'invisible': [('situacao_lotacao_esocial', '=', False)]}"/>
                                        <field name="sped_lotacao_id"
                                               invisible="1"/>
                                        <button name="atualizar_lotacao"
                                                colspan="4" type="object"
                                                string="Ativar/Atualizar e-Social"
                                                class="oe_highlight"
                                                attrs="{'invisible': ['|', ('situacao_lotacao_esocial', 'in', ['1', '3', '9']), ('lotacao_periodo_inicial_id', '=', False)]}"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>


        <record model="ir.ui.view" id="sped_esocial_res_company_tree">
            <field name="name">Empregador e-Social</field>
            <field name="model">res.company</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name" />
	                <field name="cnpj_cpf" />
	                <field name="partner_id" />
	                <field name="situacao_esocial" />
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window"
                id="sped_esocial_res_company_action">
            <field name="name">Empregador</field>
            <field name="domain">[]</field>
            <field name="res_model">res.company</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="groups_id" eval="[(4, ref('sped_tabelas.group_manager'))]" />
        </record>

        <record model="ir.actions.act_window.view"
                id="sped_esocial_res_company_form_acao">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sped_esocial_res_company_form"/>
            <field name="act_window_id" ref="sped_esocial_res_company_action"/>
        </record>

        <record model="ir.actions.act_window.view"
                id="sped_esocial_res_company_tree_acao">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sped_esocial_res_company_tree"/>
            <field name="act_window_id" ref="sped_esocial_res_company_action"/>
        </record>

        <menuitem id="sped_esocial.menu_esocial_res_company"
                  name="Empregador"
                  sequence="20"
                  groups="sped_tabelas.group_manager"
                  parent="sped_esocial.menu_sped_esocial"
                  action="sped_esocial.sped_esocial_res_company_action"
        />

    </data>
</openerp>
