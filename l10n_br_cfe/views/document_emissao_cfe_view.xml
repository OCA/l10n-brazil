<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright 2017 KMEE INFORMATICA LTDA <mileo@kmee.com.br>
    License AGPL-3 or later (http://www.gnu.org/licenses/agpl)
-->
<odoo>

    <record model="ir.ui.view" id="fiscal_document_emissao_cfe_form">
        <field name="name">l10n_br_fiscal.document.cfe.form</field>
        <field name="model">l10n_br_fiscal.document</field>
        <field name="priority">1</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="l10n_br_fiscal.document_form" />
        <field name="arch" type="xml">
            <xpath expr="//form[1]" position="attributes">
                <attribute name="string">Emissão de CF-e</attribute>
            </xpath>
            <field name="company_id" position="after">
                <field name="pagamento_autorizado_cfe" />
                <field name="configuracoes_pdv" />
            </field>
            <field name="document_serie_id" position="replace">
                <field name="document_serie" readonly="1"/>
            </field>
            <page name="recipient" position="attributes">
                <attribute name="string">Consumidor</attribute>
            </page>
<!--            <page name="empenho" position="replace" />-->
<!--            <page name="retencoes" position="replace" />-->
            <page name="delivery" position="replace" />
<!--            <field name="vr_fatura" position="after">-->
<!--                <field name="amount_missing_payment_value" invisible="1" />-->
<!--            </field>-->
<!--            <field name="pagamento_ids" position="attributes">-->
<!--                <attribute name="context">{'default_valor': amount_missing_payment_value}</attribute>-->
<!--            </field>-->
            <header position="inside">
                <button name="%(action_enviar_pagamento)d" string="Pagamento" class="oe_highlight" type="action"
                        context="{'default_valor': amount_missing_payment_value, 'default_documento_id': id}"
                        attrs="{'invisible': [('state', 'not in', ['em_digitacao', 'rejeitada']),('pagamento_autorizado_cfe','!=', False)]}"
                />
                <button name="action_document_send" string="Envia CF-e" type="object" class="btn-primary"
                        attrs="{'invisible': [('state', 'not in', ['em_digitacao', 'rejeitada','a_enviar']),('pagamento_autorizado_cfe','!=', False)]}" />
                <button name="action_send_email" string="Enviar email" type="object" class="btn-default" />
<!--                <button name="imprimir_documento" string="Imprimir" type="object" class="btn-default"-->
<!--                    attrs="{'invisible': [('state', '!=', 'autorizada'), ('modelo', '!=', '59')]}"-->
<!--                />-->
<!--                <button name="action_document_cancel" string="Cancelar CF-e" type="object" attrs="{'invisible': ['|', ('permite_cancelamento', '=', 'False'), ('state', '=', 'cancelada')]}"/>-->
<!--                <button name="gera_operacoes_subsequentes" string="Gerar NF-e de Cupom" type="object" class="btn-default"-->
<!--                    context="{'nota_de_cumpom': '1', 'manual': '1'}"-->
<!--                     attrs="{'invisible': ['|', ('documentos_subsequentes_gerados', '=', True), ('state','not in', ['autorizada'])]}"-->
<!--                />-->
<!--                <field name="documentos_subsequentes_gerados" invisible="True"/>-->
            </header>
<!--            <xpath expr="//field[@name='company_id']" position="before">-->
<!--                <field name="state" readonly="1" colspan="4" string="Situação"-->
<!--                       decoration-warning="state == 'denegada' or state_fiscal == '04'"-->
<!--                       decoration-danger="state == 'rejeitada'"-->
<!--                       />-->
<!--                <field name="mensagem_nfe" readonly="1" colspan="4" attrs="{'invisible': [('state', '!=', 'rejeitada')]}"-->
<!--                       decoration-warning="state == 'denegada' or state_fiscal == '04'"-->
<!--                       decoration-danger="state == 'rejeitada'"-->
<!--                       />-->
<!--                <field name="codigo_rejeicao_cfe" readonly="1" colspan="4"  attrs="{'invisible': ['|', ('modelo', '!=', '59'), ('state', '!=', 'rejeitada')]}" />-->
<!--            </xpath>-->
<!--            <page name="financeiro" position="after">-->
<!--                <page name="detalhe_nfe" string="CF-e">-->
<!--                    <group col="4" groups="sped_cfe.GRUPO_STATUS_PAGAMENTO_CFE">-->
<!--                        <separator string="Dados Integrador" colspan="4" />-->
<!--                        <field name="id_fila_validador" colspan="4" readonly="1"/>-->
<!--                    </group>-->
<!--                    <group col="4" attrs="{'invisible': [('permite_cancelamento', '=', False), ('state', '!=', 'cancelada')]}">-->
<!--                        <separator string="Cancelamento" colspan="4" />-->
<!--                        <field name="justificativa" colspan="4" attrs="{'readonly': [('state', '=', 'cancelada')]}" />-->
<!--                        <field name="chave_cancelamento" colspan="4" attrs="{'readonly': [('state', '=', 'cancelada')]}" />-->
<!--                        <button name="cancela_nfe" string="Cancelar CF-e" type="object" class="btn-primary"-->
<!--                            attrs="{'invisible': ['|', ('permite_cancelamento', '=', 'False'), ('state', '=', 'cancelada')]}" />-->
<!--                    </group>-->
<!--                </page>-->
<!--                <page name="suporte" string="Suporte" groups="l10n_br_base.GRUPO_SUPORTE">-->
<!--                    <group col="4">-->
<!--                        <separator string="Autorização" colspan="4" />-->
<!--                        <field name="data_hora_autorizacao" />-->
<!--                        <field name="protocolo_autorizacao" />-->
<!--                        <field name="arquivo_xml_id" colspan="4" string="CF-e" />-->
<!--                        <field name="arquivo_xml_autorizacao_id" colspan="4" string="Processo" />-->
<!--                        <field name="arquivo_pdf_id" colspan="4" string="Extrato CF-e" />-->
<!--                    </group>-->
<!--                    <group col="4" attrs="{'invisible': [('state', '!=', 'cancelada')]}">-->
<!--                        <separator string="Cancelamento" colspan="4" />-->
<!--                        <field name="data_hora_cancelamento" />-->
<!--                        <field name="protocolo_cancelamento" />-->
<!--                        <field name="arquivo_xml_cancelamento_id" colspan="4" string="Cancelamento" />-->
<!--                        <field name="arquivo_xml_autorizacao_cancelamento_id" colspan="4" string="Autorização" />-->
<!--                    </group>-->
<!--                </page>-->
<!--            </page>-->
        </field>
    </record>

    <record model="ir.ui.view" id="fiscal_document_emissao_cfe_tree">
        <field name="name">l10n_br_fiscal.document.cfe.tree</field>
        <field name="model">l10n_br_fiscal.document</field>
        <field name="priority">1</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="l10n_br_fiscal.document_tree" />
        <field name="arch" type="xml">
            <xpath expr="//tree[1]" position="attributes">
                <attribute name="string">Emissão de CF-e</attribute>
                <attribute name="decoration-warning">state == 'denegada' or state_fiscal == '04'</attribute>
                <attribute name="decoration-muted">state in ('cancelada', 'inutilizada') or state_fiscal in ('02', '03', '05', 'NC', 'MR')</attribute>
                <attribute name="decoration-info">state == 'a_enviar'</attribute>
                <attribute name="decoration-primary">state == 'enviada'</attribute>
                <attribute name="decoration-danger">state == 'rejeitada'</attribute>
            </xpath>
            <field name="partner_id" position="attributes">
                <attribute name="string">Consumidor</attribute>
            </field>
        </field>
    </record>

    <record model="ir.actions.act_window" id="fiscal_document_emissao_cfe_acao">
        <field name="name">Emissão de CF-e</field>
        <field name="context" eval="{
            'default_issuer': 'company',
            'default_fiscal_operation_type': 'out',
            'default_document_type_id': ref('l10n_br_fiscal.document_59')
            }"/>
        <field name="domain" eval="[('fiscal_operation_type', '=', 'out'),('document_type_id','=',ref('l10n_br_fiscal.document_59'))]"/>
        <field name="res_model">l10n_br_fiscal.document</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="l10n_br_fiscal.document_search" />
    </record>

    <record model="ir.actions.act_window.view" id="fiscal_document_emissao_cfe_tree_acao">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="fiscal_document_emissao_cfe_tree"/>
        <field name="act_window_id" ref="fiscal_document_emissao_cfe_acao"/>
    </record>

    <record model="ir.actions.act_window.view" id="fiscal_document_emissao_cfe_form_acao">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="fiscal_document_emissao_cfe_form"/>
        <field name="act_window_id" ref="fiscal_document_emissao_cfe_acao"/>
    </record>

    <menuitem id="document_sub_menu" name="CF-e" groups="l10n_br_fiscal.group_manager" parent="l10n_br_fiscal.document_menu" sequence="59000"/>

    <menuitem id="menu_fiscal_document_emissao_cfe" sequence="9" name="Emissão" parent="document_sub_menu" action="fiscal_document_emissao_cfe_acao" />

        <!-- Sub Menu for All Documents-->

</odoo>
