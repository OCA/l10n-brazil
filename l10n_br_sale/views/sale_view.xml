<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--Search by cnpj / cpf in the SOs -->
    <record id="view_l10n_br_sale_partner_filter" model="ir.ui.view">
        <field name="name">l10n_br_sale.partner.filter</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_sales_order_filter"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="legal_name" string="RazÃ£o Social"/>
                <field name="cnpj_cpf" string="CNPJ/CPF"/>
                <field name="ie" string="Inscr. Estadual"/>
            </field>
        </field>
    </record>

    <record id="l10n_br_sale_order_form" model="ir.ui.view">
        <field name="name">l10n_br_sale.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">
            <button name="action_view_invoice" position="after">
                <button name="action_view_document" type="object" class="oe_stat_button" icon="fa-pencil-square-o" attrs="{'invisible': [('invoice_count', '=', 0)]}">
                    <field name="fiscal_document_count" widget="statinfo" string="Fiscal Documents" modifiers="{'readonly':true}"/>
                </button>
            </button>
            <button name="action_done" position="after">
                <button name="recompute_lines_taxes" icon="fa-repeat" type="object" string="Recompute Lines Taxes" states="draft,sent"/>
            </button>
            <field name="amount_untaxed" position="before">
                <field name="amount_gross" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="amount_discount" groups="l10n_br_sale.group_discount_per_value,l10n_br_sale.group_total_discount" widget='monetary' options="{'currency_field': 'currency_id'}"/>
            </field>
            <field name="amount_untaxed" position="after">
                <field name="amount_freight" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="amount_insurance" widget='monetary' options="{'currency_field': 'currency_id'}" />
                <field name="amount_costs" widget='monetary' options="{'currency_field': 'currency_id'}" />
            </field>
            <field name="amount_tax" position="before">
                <field name="amount_ipi" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                <field name="amount_icmsst" widget='monetary' options="{'currency_field': 'currency_id'}"/>
            </field>
            <field name="validity_date" position="after">
                <field name="fiscal_operation_id" required="True"/>
                <field name="ind_pres" required="True"/>
            </field>
            <field name="note" position="replace">
                <group>
                    <field name="copy_note"/>
                    <field name="note" placeholder="Terms and conditions... (note: you can setup default ones in the Configuration menu)"/>
                    <field name="customer_additional_data"/>
                    <field name="fiscal_additional_data"/>
                </group>
            </field>
            <xpath expr="//field[@name='order_line']" position="attributes">
                <attribute name="context">{'default_fiscal_operation_id': fiscal_operation_id, 'default_partner_id': partner_id, 'default_company_id': company_id}</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree" position="attributes">
                <attribute name="editable"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree/field[@name='analytic_tag_ids']" position="replace"/>
            <xpath expr="//field[@name='order_line']/tree/field[@name='discount']" position="replace"/>
            <xpath expr="//field[@name='order_line']/tree/field[@name='tax_id']" position="replace"/>
            <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="after">
                <field name="discount" groups="!l10n_br_sale.group_discount_per_value"/>
                <field name="discount_value" groups="l10n_br_sale.group_discount_per_value"/>
                <field name="fiscal_tax_ids" widget="many2many_tags" options="{'no_create': True}"/>
                <button name="recompute_taxes"
                        icon="fa-repeat"
                        type="object"
                />
            </xpath>
            <xpath expr="//field[@name='order_line']/tree/field[@name='price_subtotal']" position="after">
                <field name="price_total" invisible="1"/>
                <field name="additional_data" invisible="1"/>
                <field name="amount_tax_not_included" invisible="1"/>
                <field name="amount_tax_withholding" invisible="1"/>
                <field name="cest_id" invisible="1"/>
                <field name="cfop_destination" invisible="1"/>
                <field name="cfop_id" invisible="1"/>
                <field name="cofins_base" invisible="1"/>
                <field name="cofins_base_id" invisible="1"/>
                <field name="cofins_base_type" invisible="1"/>
                <field name="cofins_credit_id" invisible="1"/>
                <field name="cofins_cst_code" invisible="1"/>
                <field name="cofins_cst_id" invisible="1"/>
                <field name="cofins_percent" invisible="1"/>
                <field name="cofins_reduction" invisible="1"/>
                <field name="cofins_tax_id" invisible="1"/>
                <field name="cofins_value" invisible="1"/>
                <field name="cofins_wh_base" invisible="1"/>
                <field name="cofins_wh_base_type" invisible="1"/>
                <field name="cofins_wh_percent" invisible="1"/>
                <field name="cofins_wh_reduction" invisible="1"/>
                <field name="cofins_wh_tax_id" invisible="1"/>
                <field name="cofins_wh_value" invisible="1"/>
                <field name="cofinsst_base" invisible="1"/>
                <field name="cofinsst_base_type" invisible="1"/>
                <field name="cofinsst_cst_code" invisible="1"/>
                <field name="cofinsst_cst_id" invisible="1"/>
                <field name="cofinsst_percent" invisible="1"/>
                <field name="cofinsst_reduction" invisible="1"/>
                <field name="cofinsst_tax_id" invisible="1"/>
                <field name="cofinsst_value" invisible="1"/>
                <field name="comment_ids" invisible="1"/>
                <field name="csll_base" invisible="1"/>
                <field name="csll_percent" invisible="1"/>
                <field name="csll_reduction" invisible="1"/>
                <field name="csll_tax_id" invisible="1"/>
                <field name="csll_value" invisible="1"/>
                <field name="csll_wh_base" invisible="1"/>
                <field name="csll_wh_percent" invisible="1"/>
                <field name="csll_wh_reduction" invisible="1"/>
                <field name="csll_wh_tax_id" invisible="1"/>
                <field name="csll_wh_value" invisible="1"/>
                <field name="currency_id" invisible="1"/>
                <field name="discount_value" invisible="1"/>
                <field name="display_name" invisible="1"/>
                <field name="fiscal_genre_code" invisible="1"/>
                <field name="fiscal_genre_id" invisible="1"/>
                <field name="fiscal_operation_id" invisible="1"/>
                <field name="fiscal_operation_line_id" invisible="1"/>
                <field name="fiscal_operation_type" invisible="1"/>
                <field name="fiscal_price" invisible="1"/>
                <field name="fiscal_quantity" invisible="1"/>
                <field name="fiscal_type" invisible="1"/>
                <field name="freight_value" invisible="1"/>
                <field name="icms_base" invisible="1"/>
                <field name="icms_base_type" invisible="1"/>
                <field name="icms_cst_code" invisible="1"/>
                <field name="icms_cst_id" invisible="1"/>
                <field name="icms_destination_base" invisible="1"/>
                <field name="icms_destination_percent" invisible="1"/>
                <field name="icms_destination_value" invisible="1"/>
                <field name="icms_origin" invisible="1"/>
                <field name="icms_origin_percent" invisible="1"/>
                <field name="icms_origin_value" invisible="1"/>
                <field name="icms_percent" invisible="1"/>
                <field name="icms_reduction" invisible="1"/>
                <field name="icms_relief_id" invisible="1"/>
                <field name="icms_relief_value" invisible="1"/>
                <field name="icms_sharing_percent" invisible="1"/>
                <field name="icms_tax_id" invisible="1"/>
                <field name="icms_value" invisible="1"/>
                <field name="icmsfcp_percent" invisible="1"/>
                <field name="icmsfcp_tax_id" invisible="1"/>
                <field name="icmsfcp_value" invisible="1"/>
                <field name="icmssn_base" invisible="1"/>
                <field name="icmssn_credit_value" invisible="1"/>
                <field name="icmssn_percent" invisible="1"/>
                <field name="icmssn_range_id" invisible="1"/>
                <field name="icmssn_reduction" invisible="1"/>
                <field name="icmssn_tax_id" invisible="1"/>
                <field name="icmsst_base" invisible="1"/>
                <field name="icmsst_base_type" invisible="1"/>
                <field name="icmsst_mva_percent" invisible="1"/>
                <field name="icmsst_percent" invisible="1"/>
                <field name="icmsst_reduction" invisible="1"/>
                <field name="icmsst_tax_id" invisible="1"/>
                <field name="icmsst_value" invisible="1"/>
                <field name="icmsst_wh_base" invisible="1"/>
                <field name="icmsst_wh_value" invisible="1"/>
                <field name="id" invisible="1"/>
                <field name="ii_base" invisible="1"/>
                <field name="ii_customhouse_charges" invisible="1"/>
                <field name="ii_iof_value" invisible="1"/>
                <field name="ii_percent" invisible="1"/>
                <field name="ii_tax_id" invisible="1"/>
                <field name="ii_value" invisible="1"/>
                <field name="inss_base" invisible="1"/>
                <field name="inss_percent" invisible="1"/>
                <field name="inss_reduction" invisible="1"/>
                <field name="inss_tax_id" invisible="1"/>
                <field name="inss_value" invisible="1"/>
                <field name="inss_wh_base" invisible="1"/>
                <field name="inss_wh_percent" invisible="1"/>
                <field name="inss_wh_reduction" invisible="1"/>
                <field name="inss_wh_tax_id" invisible="1"/>
                <field name="inss_wh_value" invisible="1"/>
                <field name="insurance_value" invisible="1"/>
                <field name="ipi_base" invisible="1"/>
                <field name="ipi_base_type" invisible="1"/>
                <field name="ipi_cst_code" invisible="1"/>
                <field name="ipi_cst_id" invisible="1"/>
                <field name="ipi_guideline_id" invisible="1"/>
                <field name="ipi_percent" invisible="1"/>
                <field name="ipi_reduction" invisible="1"/>
                <field name="ipi_tax_id" invisible="1"/>
                <field name="ipi_value" invisible="1"/>
                <field name="irpj_base" invisible="1"/>
                <field name="irpj_percent" invisible="1"/>
                <field name="irpj_reduction" invisible="1"/>
                <field name="irpj_tax_id" invisible="1"/>
                <field name="irpj_value" invisible="1"/>
                <field name="irpj_wh_base" invisible="1"/>
                <field name="irpj_wh_percent" invisible="1"/>
                <field name="irpj_wh_reduction" invisible="1"/>
                <field name="irpj_wh_tax_id" invisible="1"/>
                <field name="irpj_wh_value" invisible="1"/>
                <field name="issqn_base" invisible="1"/>
                <field name="issqn_deduction_amount" invisible="1"/>
                <field name="issqn_desc_cond_amount" invisible="1"/>
                <field name="issqn_desc_incond_amount" invisible="1"/>
                <field name="issqn_eligibility" invisible="1"/>
                <field name="issqn_fg_city_id" invisible="1"/>
                <field name="issqn_incentive" invisible="1"/>
                <field name="issqn_other_amount" invisible="1"/>
                <field name="issqn_percent" invisible="1"/>
                <field name="issqn_reduction" invisible="1"/>
                <field name="issqn_tax_id" invisible="1"/>
                <field name="issqn_value" invisible="1"/>
                <field name="issqn_wh_base" invisible="1"/>
                <field name="issqn_wh_percent" invisible="1"/>
                <field name="issqn_wh_reduction" invisible="1"/>
                <field name="issqn_wh_tax_id" invisible="1"/>
                <field name="issqn_wh_value" invisible="1"/>
                <field name="nbm_id" invisible="1"/>
                <field name="nbs_id" invisible="1"/>
                <field name="ncm_id" invisible="1"/>
                <field name="other_costs_value" invisible="1"/>
                <field name="partner_company_type" invisible="1"/>
                <field name="partner_id" invisible="1"/>
                <field name="partner_order" invisible="1"/>
                <field name="partner_order_line" invisible="1"/>
                <field name="pis_base" invisible="1"/>
                <field name="pis_base_id" invisible="1"/>
                <field name="pis_base_type" invisible="1"/>
                <field name="pis_credit_id" invisible="1"/>
                <field name="pis_cst_code" invisible="1"/>
                <field name="pis_cst_id" invisible="1"/>
                <field name="pis_percent" invisible="1"/>
                <field name="pis_reduction" invisible="1"/>
                <field name="pis_tax_id" invisible="1"/>
                <field name="pis_value" invisible="1"/>
                <field name="pis_wh_base" invisible="1"/>
                <field name="pis_wh_base_type" invisible="1"/>
                <field name="pis_wh_percent" invisible="1"/>
                <field name="pis_wh_reduction" invisible="1"/>
                <field name="pis_wh_tax_id" invisible="1"/>
                <field name="pis_wh_value" invisible="1"/>
                <field name="pisst_base" invisible="1"/>
                <field name="pisst_base_type" invisible="1"/>
                <field name="pisst_cst_code" invisible="1"/>
                <field name="pisst_cst_id" invisible="1"/>
                <field name="pisst_percent" invisible="1"/>
                <field name="pisst_reduction" invisible="1"/>
                <field name="pisst_tax_id" invisible="1"/>
                <field name="pisst_value" invisible="1"/>
                <field name="price_unit" invisible="1"/>
                <field name="product_id" invisible="1"/>
                <field name="quantity" invisible="1"/>
                <field name="service_type_id" invisible="1"/>
                <field name="simple_value" invisible="1"/>
                <field name="simple_without_icms_value" invisible="1"/>
                <field name="tax_icms_or_issqn" invisible="1"/>
                <field name="uom_id" invisible="1"/>
                <field name="uot_id" invisible="1"/>
                <field name="tax_framework" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/form" position="inside">
                <group name="fiscal_fields" invisible="1">
                    <field name="fiscal_operation_type" invisible="1" readonly="1"/>
                    <field name="fiscal_genre_code" invisible="1"/>
                    <field name="tax_framework" invisible="1"/>
                    <field name="tax_icms_or_issqn" invisible="1"/>
                </group>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//label[@for='customer_lead']" position="before">
                <field name="fiscal_operation_id" options="{'no_create': True}" attrs="{'readonly': [('state', 'in', ('sale', 'done', 'cancel'))], 'required': [('display_type', '=', False)]}"/>
                <field name="fiscal_operation_line_id" options="{'no_create': True}" attrs="{'readonly': [('state', 'in', ('sale', 'done', 'cancel'))], 'required': [('display_type', '=', False)]}"/>
                <field name="cfop_id" options="{'no_create': True}" attrs="{'invisible': [('tax_icms_or_issqn', '=', 'issqn')]}"/>
                <field name="price_total" invisible="1"/>
                <field name="price_subtotal" invisible="1"/>
                <field name="service_type_id" options="{'no_create': True}" attrs="{'invisible': [('tax_icms_or_issqn', '=', 'icms')]}"/>
                <field name="city_taxation_code_id" attrs="{'invisible': [('tax_icms_or_issqn', '=', 'icms')]}"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//field[@name='tax_id']" position="replace"/>
            <xpath expr="//field[@name='order_line']/form/div[@groups='base.group_no_one' and field/@name='invoice_lines']" position="replace"/>
            <xpath expr="//field[@name='order_line']/form//field[@name='price_unit']" position="after">
                <label for="fiscal_quantity" string="Fiscal Quantity"/>
                <div>
                    <field context="{'partner_id':parent.partner_id, 'quantity':fiscal_quantity, 'pricelist':parent.pricelist_id, 'uom':uot_id, 'uom_qty_change':True, 'company_id': parent.company_id}" name="fiscal_quantity" class="oe_inline"/>
                    <field name="uot_id" force_save="1" groups="uom.group_uom" class="oe_inline oe_no_button" attrs="{'readonly': [('state', 'in', ('sale', 'done', 'cancel'))], 'required': [('display_type', '=', False)],}"/>
                </div>
                <field name="fiscal_price"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/form/field[@name='name']" position="after">
                <notebook attrs="{'invisible': [('display_type', '!=', False)]}">
                  <page name="fiscal_taxes" string="Taxes"/>
                  <page string="Invoice Lines" groups="base.group_no_one" attrs="{'invisible': [('display_type', '!=', False)]}">
                      <div>
                          <label for="invoice_lines"/>
                          <field name="invoice_lines"/>
                      </div>
                  </page>
                  <page name="others" string="Others">
                      <group>
                          <field name="freight_value"/>
                          <field name="insurance_value"/>
                          <field name="other_costs_value"/>
                      </group>
                  </page>
                  <page name="fiscal_line_extra_info" string="Extra Info"/>
                  <page name="accounting" string="Accounting">
                      <group>
                          <field name="tax_id" widget="many2many_tags" options="{'no_create': True}" context="{'search_view_ref': 'account.account_tax_view_search'}" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]" attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                      </group>
                  </page>
                </notebook>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//div[@name='discount']" position="attributes">
                <attribute name="groups">!l10n_br_sale.group_discount_per_value</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//label[@for='discount']" position="attributes">
                <attribute name="groups">!l10n_br_sale.group_discount_per_value</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/form//div[@name='discount']" position="after">
              <label for="discount_value" groups="l10n_br_sale.group_discount_per_value"/>
              <div name="discount_value" groups="l10n_br_sale.group_discount_per_value">
                  <field name="discount_value" class="oe_inline"/>
              </div>
            </xpath>
            <xpath expr="//group[@name='sale_total']" position="after">
                <group style="width: 65%%"
                       groups="l10n_br_sale.group_total_discount">
                    <label for="discount_rate"/>
                    <div>
                        <field name="discount_rate" class="oe_inline"/>
                        %%
                    </div>
                </group>
            </xpath>
        </field>
    </record>

</odoo>
